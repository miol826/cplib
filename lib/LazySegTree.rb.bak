class LazySegmentTree
  def initialize(n, e, act_e)
    @n = 1 << (n - 1).bit_length
    @e = e
    @act_e = act_e
    @data = Array.new(2 * @n - 1, @e)
    @act = Array.new(2 * @n - 1, @act_e)
  end
  def update(a, b, x, i = 0, l = 0, r = @n)
    ev i
    if a <= l && r <= b then
      @act[i] = composition(@act[i], x)
      ev i
    elsif a < r && l < b then
      update(a, b, x, i * 2 + 1, l, (l + r) / 2)
      update(a, b, x, i * 2 + 2, (l + r) / 2, r)
      @data[i] = operate(@data[i * 2 + 1], @data[i * 2 + 2])
    end
  end
  def find(a, b, i = 0, l = 0, r = @n)
    ev i
    if r <= a || b <= l then
      return @e
    elsif a <= l && r <= b then
      return @data[i]
    else
      return operate(find(a, b, i * 2 + 1, l, (l + r) / 2), find(a, b, i * 2 + 2, (l + r) / 2, r))
    end
  end
  private
  def ev(i)
    unless @act[i] == @act_e then
      if i < @n - 1 then
        @act[i * 2 + 1] = composition(@act[i * 2 + 1], @act[i])
        @act[i * 2 + 2] = composition(@act[i * 2 + 2], @act[i])
      end
      @data[i] = apply(@act[i], @data[i])
      @act[i] = @act_e
    end
  end
  def operate(x, y)
  end
  def apply(m, x)
  end
  def composition(m, n)
  end
end
